# Analytics Scripts

---

**Canonical Output Notice:**

- All analytics scripts must use `omega_registry_master.json` as the only canonical input.
- All references to legacy or alternate registry outputs are deprecated unless explicitly qualified as archival or reference material under `registry_alias/`.
- Pretty-printed versions are strictly for human readability and not for programmatic use.

---

## Pipeline Visualization

```txt
[derived_views, logs, registry outputs]
           |
[analyze_omega_registry.py]   [finalize_alpha_room_registry.py]   [repair_alpha_room_registry.py]
           |
[analytics logs, finalized outputs, repaired outputs]
```

---

## Script Index

- `analyze_omega_registry.py`
  - **Purpose:** Analyzes the canonical omega registry for completeness, join quality, contract compliance, and field coverage.
  - **Outputs:**
    - `canonical/logs/analytics/omega_registry_metrics.log` (metrics, completeness, join stats)
  - **Notes:**
    - Use after generating the omega registry. Supports audit and reporting.

- `finalize_alpha_room_registry.py`
  - **Purpose:** Finalizes and validates alpha room registry outputs for downstream consumption.
  - **Outputs:**
    - `canonical/derived_views/alpha_room_registry.finalized.json`
  - **Notes:**
    - Ensures contract and schema alignment. Use before export or downstream analytics.

- `repair_alpha_room_registry.py`
  - **Purpose:** Repairs and normalizes alpha room registry artifacts, ensuring contract and schema alignment.
  - **Outputs:**
    - `canonical/derived_views/alpha_room_registry.repaired.json`
  - **Notes:**
    - Use for recovery, normalization, or when contract drift is detected.

---

## Usage & Troubleshooting

- Run analytics scripts after generating the relevant registry outputs.
- Ensure all required input files exist and are up to date.
- Outputs are written to canonical analytics or derived_views folders for traceability.
- For completeness or contract compliance issues, review the metrics and logs generated by these scripts.

---

## Machine-Friendly Execution Notes

- To ensure all internal imports (e.g., `from scripts.utils.import_path import set_workspace_root`) resolve correctly, always run analytics scripts with the workspace root as PYTHONPATH:

```sh
PYTHONPATH=. python3 scripts/analytics/analyze_omega_registry.py --input canonical/omega_registry_master.json --log canonical/logs/analytics/omega_registry_metrics.log
```

- The script always emits a copy of the metrics to `canonical/logs/analytics/pipeline_metrics.latest.json` (default persistent log file), even if a custom log location is specified. This file is used as input by various downstream scripts and should always be up to date.
- This applies to all scripts that import from the `scripts` package or submodules.
- For downstream or custom analytics, use the same PYTHONPATH convention if you encounter import errors.

---

## See Also

- Main pipeline scripts: `scripts/generators/`
- Audit scripts: `scripts/audit/`
- Transformation scripts: `scripts/transformation/`
- Diagnostics and legacy scripts: `scripts/diagnostics/`
- Contracts and pipeline docs: `canonical/support/contracts/`
- Pipeline overview and troubleshooting: `scripts/generators/README.md`
