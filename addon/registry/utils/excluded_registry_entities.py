# List of registry/meta entities to exclude from migration operations
# These are not device entities, but large registry/meta objects that cause timeouts or are not needed in migration
EXCLUDED_REGISTRY_ENTITY_IDS = [
    # Light registry meta-entity (example from timeout log)
    "_meta_schema_http_json_schema_org_hestia_v7_schema_title_alpha_light_registry_json_schema_name_hestia_alpha_light_registry_description_registry_that_accompanies_the_omega_device_registry_as_a_specialized_version_specifically_for_light_entities_version_1_5_0_migration_source_files_device_groups_json_sensor_signal_plane_json_validation_status_last_validated_2025_05_02t00_46_50_852443z_status_valid_updated_by_hephaestus_messages_protocol_definitions_matter_name_matter_description_thread_based_smart_home_protocol_priority_1_wifi_name_wi_fi_description_legacy_wireless_ip_protocol_priority_2_mqtt_name_mqtt_description_message_queuing_telemetry_transport_protocol_priority_3_ble_name_bluetooth_low_energy_description_wireless_personal_area_network_protocol_priority_4_lan_name_local_area_network_description_direct_local_network_communication_protocol_priority_5_integration_platforms_matter_name_matter_alias_none_description_thread_based_smart_home_protocol_protocol_matter_priority_1_wiz_name_wiz_alias_philips_wiz_description_signify_philips_wi_fi_protocol_for_lights_protocol_wifi_priority_2_tuya_name_tuya_alias_smartlife_description_oem_wi_fi_protocol_used_by_enshine_protocol_wifi_priority_3_smartthings_name_smartthings_alias_none_description_samsung_s_smart_home_integration_protocol_wifi_priority_4_tplink_name_tp_link_alias_tapo_description_tp_link_s_direct_device_integration_protocol_protocol_wifi_priority_5_govee_name_govee_alias_none_description_multi_protocol_integration_for_govee_lighting_devices_protocol_mqtt_ble_lan_wifi_priority_6_light_devices_bedroom_nightstand_left_omega_omega_name_bedroom_nightstand_left_light_omega_friendly_name_reading_lamp_internal_name_wiz_rgbw_tunable_f1563e_canonical_id_bedroom_nightstand_left_type_light_location_room_bedroom_area_nightstand_role_left_room_id_bedroom_room_area_bed_integration_stack_matter_protocol_matter_device_id_032c3c890097974b10b6acd970d9bcd2_type_light_entity_id_light_reading_lamp_mtr_canonical_id_bedroom_nightstand_left_matter_status_paired_availability_sensor_binary_sensor_bedroom_nightstand_left_matter_available_wiz_protocol_wifi_device_id_48f44f0fabfa49ac1e913d74a3e100ca_type_light_entity_id_light_reading_lamp_canonical_id_bedroom_nightstand_left_wifi_status_paired_availability_sensor_binary_sensor_bedroom_nightstand_left_wifi_available_preferred_protocol_matter_protocol_metrics_matter_last_seen_2025_04_22t15_30_00_response_time_ms_120_reliability_score_98_wifi_last_seen_2025_04_22t14_25_00_response_time_ms_350_reliability_score_92_fallback_settings_retry_attempts_2_retry_delay_ms_500_auto_switch_threshold_3_return_to_preferred_after_60_capabilities_brightness_true_color_temp_true_color_true_effects_none_device_info_manufacturer_philips_model_123189_model_name_candle_firmware_none_mac_44_4f_8e_f1_56_3e_ipv4_192_168_0_168_ssid_aethernet_iot_entities_entity_effect_speed_entity_id_number_wiz_rgbw_tunable_f1563e_effect_speed_name_bedroom_nightstand_left_light_alpha_effect_speed_canonical_id_bedroom_nightstand_left_effect_speed_type_input_number_entity_signal_strength_entity_id_sensor_wiz_rgbw_tunable_f1563e_signal_strength_name_bedroom_nightstand_left_light_alpha_signal_strength_canonical_id_bedroom_nightstand_left_signal_strength_type_sensor_entity_power_entity_id_sensor_wiz_rgbw_tunable_f1563e_power_name_bedroom_nightstand_left_light_alpha_power_canonical_id_bedroom_nightstand_left_power_type_sensor_entity_identify_entity_id_button_reading_lamp_mtr_identify_name_bedroom_nightstand_left_light_alpha_identify_canonical_id_bedroom_nightstand_left_identify_type_button_history_added_2025_03_15_protocol_switches_timestamp_2025_04_21t08_30_00_from_matter_to_wifi_reason_unavailable_timestamp_2025_04_21t19_45_00_from_wifi_to_matter_reason_preferred_restored_confidence_metrics_entity_confidence_score_90_factors_multiple_consistent_entities_clear_entity_purposes_uncertain_fields_device_confidence_score_90_factors_complete_device_information_clear_room_assignment_relationship_confidence_score_95_factors_consistent_entity_naming_clear_functional_grouping_requires_review_false_fallback_settings_retry_attempts_2_retry_delay_ms_500_auto_switch_threshold_3_return_to_preferred_after_60_protocol_metrics_",
    # Room registry meta-entity (example from timeout log)
    "_meta_schema_http_json_schema_org_hestia_v7_schema_title_room_registry_json_schema_name_hestia_unified_room_management_schema_description_hestia_unified_room_management_schema_version_1_1_0_migration_source_files_room_groups_json_room_adjacency_json_room_categories_json_room_configurations_json_validation_status_last_validated_2025_04_29t22_01_07_391306z_status_valid_updated_by_hephaestus_messages_metadata_created_at_2025_05_09t18_56_06_126435z_updated_at_2025_05_09t18_56_06_126435z_validated_by_hephaestus_room_manager_status_new_categories_definitions_common_name_common_areas_description_shared_living_spaces_behavior_profiles_version_1_0_changelog_private_name_private_spaces_description_personal_or_restricted_access_spaces_behavior_profiles_version_1_0_changelog_entertainment_name_entertainment_zones_description_areas_for_recreation_and_media_behavior_profiles_version_1_0_changelog_area_definitions_behaviors_behavior_schedules_rooms_living_room_id_living_room_friendly_name_living_room_aliases_common_room_cinema_clapham_type_common_floor_1_groups_floor_1_categories_common_entertainment_areas_couch_windows_desk_liquor_cabinet_adjacency_connected_rooms_kitchen_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_downstairs_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_devices_lights_sensors_temperature_omega_living_room_multipurpose_sensor_omega_alpha_beta_eta_delta_gamma_zeta_mu_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_living_room_multipurpose_sensor_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_living_room_multipurpose_sensor_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_mood_day_mood_night_gaming_tv_time_circadian_climate_drafty_thermostatic_presence_motion_occupancy_security_none_media_projector_audio_zone_gaming_console_vacuum_segment_id_19_default_brightness_60_circadian_type_brightness_version_1_0_presence_msf_rate_limited_validated_changelog_metadata_created_at_2025_04_29t18_56_06_126366z_updated_at_2025_04_29t18_56_06_126366z_validated_by_hephaestus_room_manager_status_validated_bedroom_id_bedroom_friendly_name_bedroom_aliases_everts_room_evert_s_room_master_bedroom_suite_belge_etage_type_private_floor_2_groups_floor_2_categories_private_areas_desk_ottoman_wardrobe_monstera_bed_mirror_adjacency_connected_rooms_hallway_connection_type_doorway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_ensuite_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_desk_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_wardrobe_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_ottoman_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_monstera_connection_type_doorway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_devices_fan_fan_levoit_air_purifier_fan_probreeze_fan_bedroom_fan_dehumidifier_humidifier_probreeze_monitor_switch_monitor_lights_sensors_temperature_omega_alpha_sensor_probreeze_temperature_sensor_bedroom_smartbutton_temperature_sensor_bedroom_climate_temperature_beta_eta_delta_gamma_zeta_mu_humidity_omega_alpha_sensor_probreeze_humidity_sensor_bedroom_climate_humidity_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_binary_sensor_wardrobe_motion_sensor_binary_sensor_wardrobe_motion_sensor_motion_beta_eta_delta_gamma_zeta_mu_occupancy_omega_bedroom_occupancy_omega_alpha_binary_sensor_bedroom_occupancy_binary_sensor_wardrobe_occupancy_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_mood_day_mood_night_circadian_gaming_tv_time_red_climate_thermostatic_humidity_sensitive_ventilation_presence_motion_occupancy_contact_inferred_security_camera_media_tv_gaming_console_audio_zone_vacuum_segment_id_none_version_1_2_changelog_default_brightness_60_circadian_type_brightness_presence_msf_rate_limited_validated_metadata_created_at_2025_04_29t18_56_06_126382z_updated_at_2025_04_29t18_56_06_126382z_validated_by_hephaestus_room_manager_status_validated_laundry_id_laundry_friendly_name_laundry_room_aliases_type_common_floor_1_groups_floor_1_categories_common_areas_adjacency_connected_rooms_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_task_light_mood_day_mood_night_climate_none_presence_proxy_security_none_media_none_vacuum_segment_id_16_version_1_0_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126387z_updated_at_2025_04_29t18_56_06_126387z_validated_by_hephaestus_room_manager_status_validated_ensuite_id_ensuite_friendly_name_ensuite_aliases_bathroom_sauna_paraiso_type_private_floor_2_groups_floor_2_categories_private_areas_adjacency_connected_rooms_bedroom_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_desk_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_wardrobe_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_monstera_connection_type_doorway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_ensuite_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_mood_day_mood_night_circadian_night_light_vaporwave_climate_interior_bathroom_presence_occupancy_security_none_media_audio_zone_version_1_0_changelog_default_brightness_60_circadian_type_brightness_presence_msf_rate_limited_validated_metadata_created_at_2025_04_29t18_56_06_126393z_updated_at_2025_04_29t18_56_06_126393z_validated_by_hephaestus_room_manager_status_validated_downstairs_id_downstairs_friendly_name_downstairs_hallway_aliases_ground_floor_floor_1_hallway_type_common_floor_1_groups_floor_1_categories_areas_adjacency_connected_rooms_living_room_connection_type_open_archway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_kitchen_connection_type_doorway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_bedroom_connection_type_staircase_distance_meters_5_0_transition_time_seconds_5_0_door_sensor_none_accessibility_true_powder_room_connection_type_doorway_distance_meters_0_5_transition_time_seconds_2_0_door_sensor_none_accessibility_true_entrance_connection_type_staircase_distance_meters_2_0_transition_time_seconds_3_0_door_sensor_none_accessibility_true_upstairs_connection_type_staircase_distance_meters_4_0_transition_time_seconds_4_0_door_sensor_none_accessibility_true_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_mood_day_mood_night_circadian_night_light_climate_none_presence_motion_occupancy_contact_security_none_media_none_vacuum_segment_id_18_presence_msf_rate_limited_validated_version_1_0_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126401z_updated_at_2025_04_29t18_56_06_126401z_validated_by_hephaestus_room_manager_status_validated_upstairs_id_upstairs_friendly_name_upstairs_hallway_aliases_top_floor_floor_2_type_common_floor_2_groups_floor_2_categories_areas_adjacency_connected_rooms_downstairs_connection_type_doorway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_bedroom_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_mood_day_mood_night_circadian_night_light_climate_none_presence_motion_occupancy_security_none_media_none_vacuum_segment_id_none_version_1_0_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126407z_updated_at_2025_04_29t18_56_06_126407z_validated_by_hephaestus_room_manager_status_validated_kitchen_id_kitchen_friendly_name_kitchen_aliases_type_common_floor_1_groups_floor_1_categories_common_areas_kitchen_counters_dining_table_coffee_corner_adjacency_connected_rooms_laundry_connection_type_open_archway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_downstairs_connection_type_doorway_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_scene_control_ambient_only_task_light_circadian_climate_thermostatic_presence_motion_occupancy_security_none_media_audio_zone_vacuum_segment_id_17_version_1_0_presence_msf_rate_limited_validated_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126412z_updated_at_2025_04_29t18_56_06_126412z_validated_by_hephaestus_room_manager_status_validated_entrance_id_entrance_friendly_name_entrance_aliases_front_door_main_door_entryway_type_common_floor_1_groups_floor_1_categories_areas_adjacency_connected_rooms_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_lightstrips_mood_day_mood_night_night_light_climate_none_presence_motion_occupancy_security_none_media_none_vacuum_segment_id_none_presence_msf_rate_limited_validated_version_1_0_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126420z_updated_at_2025_04_29t18_56_06_126420z_validated_by_hephaestus_room_manager_status_validated_wardrobe_id_wardrobe_friendly_name_wardrobe_aliases_closet_type_utility_floor_2_groups_floor_2_categories_areas_adjacency_connected_rooms_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_utility_light_circadian_climate_none_presence_motion_security_none_media_none_presence_msf_rate_limited_validated_version_1_0_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126425z_updated_at_2025_04_29t18_56_06_126425z_validated_by_hephaestus_room_manager_status_validated_parent_room_bedroom_ottoman_id_ottoman_friendly_name_ottoman_aliases_bed_storage_bed_lift_up_base_type_utility_floor_2_groups_floor_2_categories_areas_adjacency_connected_rooms_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_utility_light_climate_none_presence_contact_sensor_security_none_media_none_presence_msf_none_version_1_0_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126430z_updated_at_2025_04_29t18_56_06_126430z_validated_by_hephaestus_room_manager_status_validated_parent_room_bedroom_desk_id_desk_friendly_name_desk_office_aliases_office_type_private_floor_2_groups_floor_2_categories_private_areas_adjacency_connected_rooms_bedroom_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_ensuite_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_wardrobe_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_ottoman_connection_type_high_proximity_distance_meters_0_0_transition_time_seconds_0_0_door_sensor_none_accessibility_true_devices_lights_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_mood_day_mood_night_task_light_gaming_red_circadian_climate_thermostatic_humidity_sensitive_presence_motion_occupancy_inference_security_camera_media_audio_zone_pc_vacuum_segment_id_none_presence_msf_rate_limited_validated_inference_version_1_0_changelog_default_brightness_60_circadian_type_brightness_metadata_created_at_2025_04_29t18_56_06_126435z_updated_at_2025_05_09t18_56_06_126435z_validated_by_hephaestus_room_manager_status_validated_parent_room_bedroom_powder_room_id_powder_room_friendly_name_toilet_guest_bathroom_aliases_toilet_type_common_floor_1_groups_floor_1_categories_common_areas_adjacency_connected_rooms_downstairs_connection_type_doorway_distance_meters_0_5_transition_time_seconds_0_5_door_sensor_none_accessibility_true_configuration_circadian_type_none_devices_configuration_lights_configuration_sensors_temperature_humidity_omega_alpha_beta_eta_delta_gamma_zeta_mu_motion_omega_alpha_beta_eta_delta_gamma_zeta_mu_occupancy_omega_alpha_beta_eta_delta_gamma_zeta_mu_illuminance_omega_alpha_beta_eta_delta_gamma_zeta_mu_contact_omega_alpha_beta_eta_delta_gamma_zeta_mu_configuration_lighting_none_climate_none_presence_none_security_none_media_none_vacuum_segment_id_20_version_1_0_changelog_"
]

import re
# Helper: Exclude entities whose canonical_entity_key or entity_id matches a regex (e.g. contains 'json schema')
EXCLUDED_ENTITY_REGEXES = [
    re.compile(r"json[_\s-]?schema", re.IGNORECASE),
]
def is_excluded_entity(entity_id):
    if entity_id in EXCLUDED_REGISTRY_ENTITY_IDS:
        return True
    for regex in EXCLUDED_ENTITY_REGEXES:
        if regex.search(entity_id):
            return True
    return False
